{"id": "4928d8cc-4afd-4b56-b2f4-dac340ca3b85", "code": "#include <cstdint>\n#include <unordered_map>\n#include <set>\n\ntypedef uint64_t obj_id_t;\n\n// GDSF-inspired hybrid: frequency/size, small object bias, recency tiebreak\nclass CacheManager {\nprivate:\n    struct Node {\n        double priority;\n        uint64_t timestamp;\n        uint64_t freq;\n        uint64_t size;\n        obj_id_t id;\n        Node(double p, uint64_t ts, uint64_t f, uint64_t s, obj_id_t i)\n            : priority(p), timestamp(ts), freq(f), size(s), id(i) {}\n        bool operator<(const Node &o) const {\n            if (priority != o.priority) return priority < o.priority;\n            return timestamp < o.timestamp;\n        }\n    };\n\n    std::set<Node> pq;\n    std::unordered_map<obj_id_t, std::set<Node>::iterator> obj2it;\n    std::unordered_map<obj_id_t, uint64_t> obj2size;\n    double last_evict_pri = 0.0;\n    uint64_t counter = 0;\n\n    double calc_priority(uint64_t freq, uint64_t size) {\n        // GDSF: L + freq*1e6/size, favor smalls and recency\n        // Add a mild \"age\" factor to frequency (decay by 10% on each eviction)\n        // and a slightly stronger small object bonus.\n        double small_bonus = (size <= 8) ? 2.0 : 0.0;\n        if (size == 0) return last_evict_pri + (freq + small_bonus) * 1e6 + counter * 1e-4;\n        return last_evict_pri + (freq + small_bonus) * 1e6 / size + counter * 1e-4;\n    }\n\npublic:\n    bool find(obj_id_t obj_id) {\n        auto it = obj2it.find(obj_id);\n        if (it == obj2it.end()) return false;\n        Node node = *(it->second);\n        pq.erase(it->second);\n        node.freq += (node.size <= 8) ? 2 : 1; // boost small objects' freq further on hit\n        node.timestamp = ++counter;\n        node.priority = calc_priority(node.freq, node.size);\n        auto iter = pq.insert(node).first;\n        obj2it[obj_id] = iter;\n        obj2size[obj_id] = node.size;\n        return true;\n    }\n\n    void insert(obj_id_t obj_id, uint64_t obj_size) {\n        auto it = obj2it.find(obj_id);\n        if (it != obj2it.end()) {\n            find(obj_id);\n            return;\n        }\n        uint64_t init_freq = (obj_size <= 8) ? 2 : 1; // small objects start hotter\n        Node node(calc_priority(init_freq, obj_size), ++counter, init_freq, obj_size, obj_id);\n        auto iter = pq.insert(node).first;\n        obj2it[obj_id] = iter;\n        obj2size[obj_id] = obj_size;\n    }\n\n    obj_id_t evict() {\n        if (pq.empty()) return 0;\n        auto it = pq.begin();\n        obj_id_t victim = it->id;\n        last_evict_pri = it->priority;\n\n        // Decay the frequency of all objects except the evicted one,\n        // but do not let frequency fall below 1.\n        std::vector<std::pair<obj_id_t, Node>> updates;\n        for (auto oit = pq.begin(); oit != pq.end(); ++oit) {\n            if (oit->id == victim) continue;\n            Node n = *oit;\n            uint64_t new_freq = n.freq > 1 ? uint64_t(n.freq * 0.9) : 1;\n            if (new_freq != n.freq) {\n                n.freq = new_freq;\n                n.priority = calc_priority(n.freq, n.size);\n                updates.emplace_back(n.id, n);\n            }\n        }\n        // Apply updates: remove and re-insert with new priority\n        for (const auto& pr : updates) {\n            auto sit = obj2it[pr.first];\n            pq.erase(sit);\n            auto iter = pq.insert(pr.second).first;\n            obj2it[pr.first] = iter;\n        }\n\n        pq.erase(it);\n        obj2it.erase(victim);\n        obj2size.erase(victim);\n        return victim;\n    }\n};", "language": "python", "parent_id": "1230052e-35c7-4ad7-952f-e86d6fb49303", "generation": 6, "timestamp": 1763753843.1114917, "iteration_found": 71, "metrics": {"combined_score": -Infinity}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Change 1: Replace 6 lines with 8 lines\nChange 2: Replace 10 lines with 32 lines", "parent_metrics": {"combined_score": 0.8508, "miss_ratio_4": 0.3666, "miss_ratio_45": 0.2546, "miss_ratio_450": 0.1492}, "island": 1}, "prompts": null, "artifacts_json": null, "artifact_dir": null, "embedding": null}